{% extends "base.html" %}

{% block title %}Chat AI{% endblock %}

{% block extra_css %}
<style>
    #chatBox {
        height: 500px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 20px;
        background-color: #f8f9fa;
    }
    .message {
        margin-bottom: 15px;
        padding: 10px 15px;
        border-radius: 10px;
        max-width: 70%;
    }
    .user-message {
        background-color: #2563eb;
        color: white;
        margin-left: auto;
        text-align: right;
    }
    .ai-message {
        background-color: white;
        border: 1px solid #ddd;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="mb-4">Chat v·ªõi AI t∆∞ v·∫•n du l·ªãch</h1>
    
    <div class="row">
        <div class="col-lg-8">
            <div id="chatBox"></div>
            
            <div class="input-group mt-3">
                <input type="text" class="form-control" id="messageInput" 
                       placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." 
                       onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="btn btn-primary" onclick="sendMessage()">G·ª≠i</button>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">üí° G·ª£i √Ω c√¢u h·ªèi</h5>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-secondary btn-sm" onclick="askSuggestion('G·ª£i √Ω l·ªãch tr√¨nh H√† N·ªôi 3 ng√†y')">
                            L·ªãch tr√¨nh H√† N·ªôi 3 ng√†y
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="askSuggestion('Nh·ªØng ƒë·ªãa ƒëi·ªÉm n·ªïi ti·∫øng ·ªü ƒê√† N·∫µng')">
                            ƒê·ªãa ƒëi·ªÉm ƒê√† N·∫µng
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="askSuggestion('∆Ø·ªõc t√≠nh chi ph√≠ du l·ªãch Sapa 2 ng√†y')">
                            Chi ph√≠ Sapa 2 ng√†y
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="askSuggestion('M√≥n ƒÉn ƒë·∫∑c s·∫£n mi·ªÅn Trung')">
                            ·∫®m th·ª±c mi·ªÅn Trung
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let sessionId = null;

function addMessage(content, isUser = false) {
    const chatBox = document.getElementById('chatBox');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
    messageDiv.textContent = content;
    chatBox.appendChild(messageDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage() {
    const input = document.getElementById('messageInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    addMessage(message, true);
    input.value = '';
    
    try {
        const response = await fetch('/api/ai/chat', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                message: message,
                session_id: sessionId
            })
        });
        
        const data = await response.json();
        
        if (data.session_id) sessionId = data.session_id;
        addMessage(data.response);
        
    } catch (error) {
        console.error('Error:', error);
        addMessage('Xin l·ªói, ƒë√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.');
    }
}

function askSuggestion(question) {
    document.getElementById('messageInput').value = question;
    sendMessage();
}

addMessage('Xin ch√†o! T√¥i l√† tr·ª£ l√Ω AI du l·ªãch. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n l√™n l·ªãch tr√¨nh, g·ª£i √Ω ƒë·ªãa ƒëi·ªÉm, ∆∞·ªõc t√≠nh chi ph√≠. B·∫°n c·∫ßn t∆∞ v·∫•n g√¨?');
</script>
{% endblock %}